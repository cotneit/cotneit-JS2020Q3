(()=>{"use strict";var t={};function e(t){return t<10?"0"+t:""+t}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class s{constructor(){this.intervals=[]}update(){this.intervals[this.intervals.length-1]+=1e3,this.updateElement()}start(){this.active=!0,this.intervals.push(0),this.interval=setInterval((()=>{this.update()}),1e3)}pause(){this.active&&(clearInterval(this.interval),this.active=!1)}reset(){this.pause(),this.intervals.length=0,this.updateElement()}getTime(){const t=e(this.getHours()),s=e(this.getMinutes()),i=e(this.getSeconds());return"00"===t?`${s}:${i}`:`${t}:${s}:${i}`}getMilliseconds(){return this.intervals.reduce(((t,e)=>t+e),0)%1e3}getSeconds(){const t=this.intervals.reduce(((t,e)=>t+e),0);return Math.floor(t%6e4/1e3)}getMinutes(){const t=this.intervals.reduce(((t,e)=>t+e),0);return Math.floor(t%36e5/6e4)}getHours(){const t=this.intervals.reduce(((t,e)=>t+e),0);return Math.floor(t/36e5)}createElement(t){return this.DOMElement=document.createElement(t),this.updateElement(),this.DOMElement}updateElement(){this.DOMElement&&(this.DOMElement.textContent=this.getTime())}}const i=t.p+"assets/audio/tile-move.mp3";document.documentElement.classList.add("page"),document.body.classList.add("page__inner");const n=(new class{constructor(){this.timer=new s,this.state={size:4,tiles:[],moves:0,isSolved:!1},this.stateProxy=new Proxy(this.state,{set:(t,e,s,i)=>("moves"===e&&(this.elements.moveCounter.textContent="Moves: "+s),"size"===e?(Reflect.set(t,e,s,i),this.startNewGame(),!0):Reflect.set(t,e,s,i))}),this.eventListeners={tileOnClick:t=>{const{tiles:e,size:s}=this.state,i=e.map((t=>t.element)).indexOf(t.target),n=t.target;this.isTransitioning||this.state.isSolved||-1===e[i]?.id||-1===i||(this.timer.active||this.timer.start(),(t=>{switch(t){case!1:break;case"left":[e[i],e[i-1]]=[e[i-1],e[i]],n.style.transform="translateX(-100%) translateX(-2px)",this.stateProxy.moves+=1;break;case"right":[e[i],e[i+1]]=[e[i+1],e[i]],n.style.transform="translateX(100%) translateX(2px)",this.stateProxy.moves+=1;break;case"top":[e[i],e[i-s]]=[e[i-s],e[i]],n.style.transform="translateY(-100%) translateY(-2px)",this.stateProxy.moves+=1;break;case"bottom":[e[i],e[i+s]]=[e[i+s],e[i]],n.style.transform="translateY(100%) translateY(2px)",this.stateProxy.moves+=1;break;default:throw new Error(`Invalid argument '${t}'`)}})((()=>{switch(!0){case-1===e[i-1]?.id&&i%s!=0:return"left";case-1===e[i+1]?.id&&i%s!=s-1:return"right";case-1===e[i-s]?.id:return"top";case-1===e[i+s]?.id:return"bottom";default:return!1}})()))},tileOnTransitionStart:t=>{"transform"===t.propertyName&&(this.isTransitioning=!0,new Audio(i).play())},tileOnTransitionEnd:t=>{"transform"===t.propertyName&&(this.renderTiles(),this.checkState())}}}init(){return this.createElements(),this.generateTiles(),this.startNewGame(),this.elements.container}startNewGame(){this.state.isSolved=!1,this.stateProxy.moves=0,this.timer.reset(),this.shuffleTiles(),this.renderTiles(),this.elements.board.style.gridTemplateColumns=`repeat(${this.state.size}, 1fr)`}generateTiles(){const t=this.state.size**2,e=[],s={id:-1,element:document.createElement("div")};for(let s=0;s<t-1;s+=1){const t={};t.id=s+1,t.element=document.createElement("div"),t.element.classList.add("gem-puzzle__tile"),t.element.textContent=t.id,e.push(t)}e.push(s),this.state.tiles=e}renderTiles(){const{tiles:t}=this.state,e=document.createDocumentFragment();t.forEach((t=>{t.element.style.transform="",e.append(t.element)})),this.elements.board.append(e),this.isTransitioning=!1}checkState(){const t=this.state.tiles.map((t=>t.id));for(let e=0;e+2<t.length;e+=1)if(t[e+1]!==t[e]+1)return;this.timer.pause(),this.state.isSolved=!0,setTimeout((()=>{alert(`You solved the puzzle in ${this.timer.getTime()} and made ${this.state.moves} moves.`)}),0)}shuffleTiles(){const t=this.state.size**2,{tiles:e}=this.state;for(let s=0;s<t;s+=1){const i=Math.floor(Math.random()*t);[e[s],e[i]]=[e[i],e[s]]}this.isSolvable()||this.shuffleTiles()}isSolvable(){const{tiles:t,size:e}=this.state,s=t.map((t=>t.id)),i=s.indexOf(-1),n=Math.ceil((i+1)/e);let r=0;for(let t=0;t<s.length;t+=1)if(-1!==s[t])for(let e=t;e<s.length;e+=1)s[t]>s[e]&&-1!==s[e]&&(r+=1);if(e%2==1&&r%2==0)return!0;if(e%2==0){if(n%2==1&&r%2==1)return!0;if(n%2==0&&r%2==0)return!0}return!1}createElements(){const t=document.createElement("div"),e=document.createElement("div"),s=document.createElement("div"),i=document.createElement("span"),n=document.createElement("span"),r=document.createElement("button");t.classList.add("gem-puzzle"),e.classList.add("gem-puzzle__status-bar"),s.classList.add("gem-puzzle__board"),s.style.gridTemplateColumns=`repeat(${this.state.size}, 1fr)`,s.addEventListener("click",this.eventListeners.tileOnClick),s.addEventListener("transitionstart",this.eventListeners.tileOnTransitionStart),s.addEventListener("transitionend",this.eventListeners.tileOnTransitionEnd),i.textContent="Timer: ",i.append(this.timer.createElement("time")),n.textContent="Moves: 0",r.type="button",r.classList.add("gem-puzzle__button"),r.textContent="New game",r.addEventListener("click",(()=>{this.startNewGame()})),e.append(i,r,n),t.append(e,s),this.elements={container:t,statusBar:e,board:s,timer:i,moveCounter:n}}}).init();document.body.append(n)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZW0tcHV6emxlL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvZ2VtLXB1enpsZS91dGlscy5qcyIsIndlYnBhY2s6Ly9nZW0tcHV6emxlL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9nZW0tcHV6emxlLy4vc3JjL2dlbS1wdXp6bGUvVGltZXIuanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9nZW0tcHV6emxlL2Fzc2V0cy9hdWRpby90aWxlLW1vdmUubXAzIiwid2VicGFjazovL2dlbS1wdXp6bGUvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vZ2VtLXB1enpsZS8uL3NyYy9nZW0tcHV6emxlL2dlbS1wdXp6bGUuanMiXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImFwcGVuZFplcm8iLCJudW0iLCJnIiwiZ2xvYmFsVGhpcyIsInRoaXMiLCJGdW5jdGlvbiIsImUiLCJ3aW5kb3ciLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwibG9jYXRpb24iLCJkb2N1bWVudCIsImN1cnJlbnRTY3JpcHQiLCJzcmMiLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJsZW5ndGgiLCJFcnJvciIsInJlcGxhY2UiLCJwIiwiVGltZXIiLCJpbnRlcnZhbHMiLCJ1cGRhdGVFbGVtZW50IiwiYWN0aXZlIiwicHVzaCIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJ1cGRhdGUiLCJjbGVhckludGVydmFsIiwicGF1c2UiLCJob3VycyIsImdldEhvdXJzIiwibWludXRlcyIsImdldE1pbnV0ZXMiLCJzZWNvbmRzIiwiZ2V0U2Vjb25kcyIsInJlZHVjZSIsImFjYyIsImN1cnIiLCJ0aW1lUGFzc2VkIiwiTWF0aCIsImZsb29yIiwidGFnIiwiRE9NRWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsImdldFRpbWUiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJib2R5IiwiZ2VtUHV6emxlRWxlbWVudCIsInRpbWVyIiwic3RhdGUiLCJzaXplIiwidGlsZXMiLCJtb3ZlcyIsImlzU29sdmVkIiwic3RhdGVQcm94eSIsIlByb3h5Iiwic2V0IiwidGFyZ2V0IiwicHJvcCIsInZhbHVlIiwicmVjZWl2ZXIiLCJlbGVtZW50cyIsIm1vdmVDb3VudGVyIiwiUmVmbGVjdCIsInN0YXJ0TmV3R2FtZSIsImV2ZW50TGlzdGVuZXJzIiwidGlsZU9uQ2xpY2siLCJldmVudCIsImluZGV4IiwibWFwIiwidGlsZSIsImVsZW1lbnQiLCJpbmRleE9mIiwiaXNUcmFuc2l0aW9uaW5nIiwiaWQiLCJzdGFydCIsImRpcmVjdGlvbiIsInN0eWxlIiwidHJhbnNmb3JtIiwibW92ZVRpbGUiLCJnZXRFbXB0eVRpbGVEaXJlY3Rpb24iLCJ0aWxlT25UcmFuc2l0aW9uU3RhcnQiLCJwcm9wZXJ0eU5hbWUiLCJBdWRpbyIsInBsYXkiLCJ0aWxlT25UcmFuc2l0aW9uRW5kIiwicmVuZGVyVGlsZXMiLCJjaGVja1N0YXRlIiwiY3JlYXRlRWxlbWVudHMiLCJnZW5lcmF0ZVRpbGVzIiwiY29udGFpbmVyIiwicmVzZXQiLCJzaHVmZmxlVGlsZXMiLCJib2FyZCIsImdyaWRUZW1wbGF0ZUNvbHVtbnMiLCJ0aWxlQW1vdW50IiwiZW1wdHlUaWxlIiwiaSIsInRpbGVDb250YWluZXIiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiZm9yRWFjaCIsImFwcGVuZCIsInRpbGVJZHMiLCJzZXRUaW1lb3V0IiwiYWxlcnQiLCJyYW5kb21UaWxlIiwicmFuZG9tIiwiaXNTb2x2YWJsZSIsImVtcHR5VGlsZUluZGV4IiwiZW1wdHlUaWxlUm93IiwiY2VpbCIsImludmVyc2lvbnMiLCJqIiwic3RhdHVzQmFyIiwibmV3R2FtZUJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0eXBl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LFVBRzFDa0QsRUFBVTlDLFVBQVVDLElBQUksY0FDeEJvRSxFQUFVckUsVUFBVUMsSUFBSSwwQkFDeEJnRCxFQUFNakQsVUFBVUMsSUFBSSxxQkFDcEJnRCxFQUFNaEIsTUFBTWlCLG9CQUFzQixVQUFVOUYsS0FBS2lELE1BQU1DLGFBQ3ZEMkMsRUFBTXNCLGlCQUFpQixRQUFTbkgsS0FBS2lFLGVBQWVDLGFBQ3BEMkIsRUFBTXNCLGlCQUFpQixrQkFBbUJuSCxLQUFLaUUsZUFBZWdCLHVCQUM5RFksRUFBTXNCLGlCQUFpQixnQkFBaUJuSCxLQUFLaUUsZUFBZW9CLHFCQUc1RHJDLEVBQU1QLFlBQWMsVUFDcEJPLEVBQU1xRCxPQUFPckcsS0FBS2dELE1BQU1SLGNBQWMsU0FHdENzQixFQUFZckIsWUFBYyxXQUcxQnlFLEVBQVdFLEtBQU8sU0FDbEJGLEVBQVd0RSxVQUFVQyxJQUFJLHNCQUN6QnFFLEVBQVd6RSxZQUFjLFdBQ3pCeUUsRUFBV0MsaUJBQWlCLFNBQVMsS0FDbkNuSCxLQUFLZ0Usa0JBR1BpRCxFQUFVWixPQUFPckQsRUFBT2tFLEVBQVlwRCxHQUNwQzRCLEVBQVVXLE9BQU9ZLEVBQVdwQixHQUU1QjdGLEtBQUs2RCxTQUFXLENBQ2Q2QixZQUNBdUIsWUFDQXBCLFFBQ0E3QyxRQUNBYyxrQkR0UTZCdUQsT0FDbkM5RyxTQUFTdUMsS0FBS3VELE9BQU90RCxJIiwiZmlsZSI6ImFwcC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L3ByZWZlci1kZWZhdWx0LWV4cG9ydCAqL1xuZnVuY3Rpb24gYXBwZW5kWmVybyhudW0pIHtcbiAgcmV0dXJuIG51bSA8IDEwID8gYDAke251bX1gIDogYCR7bnVtfWA7XG59XG5cbmV4cG9ydCB7XG4gIGFwcGVuZFplcm8sXG59O1xuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmNcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSBzY3JpcHRVcmwgPSBzY3JpcHRzW3NjcmlwdHMubGVuZ3RoIC0gMV0uc3JjXG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsOyIsImltcG9ydCB7IGFwcGVuZFplcm8gfSBmcm9tICcuL3V0aWxzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmludGVydmFscyA9IFtdO1xuICB9XG5cbiAgdXBkYXRlKCkge1xuICAgIHRoaXMuaW50ZXJ2YWxzW3RoaXMuaW50ZXJ2YWxzLmxlbmd0aCAtIDFdICs9IDEwMDA7XG4gICAgdGhpcy51cGRhdGVFbGVtZW50KCk7XG4gIH1cblxuICBzdGFydCgpIHtcbiAgICB0aGlzLmFjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5pbnRlcnZhbHMucHVzaCgwKTtcbiAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICB9LCAxMDAwKTtcbiAgfVxuXG4gIHBhdXNlKCkge1xuICAgIGlmICh0aGlzLmFjdGl2ZSkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5wYXVzZSgpO1xuICAgIHRoaXMuaW50ZXJ2YWxzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy51cGRhdGVFbGVtZW50KCk7XG4gIH1cblxuICBnZXRUaW1lKCkge1xuICAgIGNvbnN0IGhvdXJzID0gYXBwZW5kWmVybyh0aGlzLmdldEhvdXJzKCkpO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBhcHBlbmRaZXJvKHRoaXMuZ2V0TWludXRlcygpKTtcbiAgICBjb25zdCBzZWNvbmRzID0gYXBwZW5kWmVybyh0aGlzLmdldFNlY29uZHMoKSk7XG5cbiAgICBpZiAoaG91cnMgPT09ICcwMCcpIHtcbiAgICAgIHJldHVybiBgJHttaW51dGVzfToke3NlY29uZHN9YDtcbiAgICB9XG5cbiAgICByZXR1cm4gYCR7aG91cnN9OiR7bWludXRlc306JHtzZWNvbmRzfWA7XG4gIH1cblxuICBnZXRNaWxsaXNlY29uZHMoKSB7XG4gICAgY29uc3QgdGltZVBhc3NlZCA9IHRoaXMuaW50ZXJ2YWxzLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiAoYWNjICsgY3VyciksIDApO1xuICAgIGNvbnN0IG1pbGxpc2Vjb25kcyA9IHRpbWVQYXNzZWQgJSAxMDAwO1xuICAgIHJldHVybiBtaWxsaXNlY29uZHM7XG4gIH1cblxuICBnZXRTZWNvbmRzKCkge1xuICAgIGNvbnN0IHRpbWVQYXNzZWQgPSB0aGlzLmludGVydmFscy5yZWR1Y2UoKGFjYywgY3VycikgPT4gKGFjYyArIGN1cnIpLCAwKTtcbiAgICBjb25zdCBzZWNvbmRzID0gTWF0aC5mbG9vcigodGltZVBhc3NlZCAlIDYwMDAwKSAvIDEwMDApO1xuICAgIHJldHVybiBzZWNvbmRzO1xuICB9XG5cbiAgZ2V0TWludXRlcygpIHtcbiAgICBjb25zdCB0aW1lUGFzc2VkID0gdGhpcy5pbnRlcnZhbHMucmVkdWNlKChhY2MsIGN1cnIpID0+IChhY2MgKyBjdXJyKSwgMCk7XG4gICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKHRpbWVQYXNzZWQgJSAoNjAgKiA2MDAwMCkpIC8gNjAwMDApO1xuICAgIHJldHVybiBtaW51dGVzO1xuICB9XG5cbiAgZ2V0SG91cnMoKSB7XG4gICAgY29uc3QgdGltZVBhc3NlZCA9IHRoaXMuaW50ZXJ2YWxzLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiAoYWNjICsgY3VyciksIDApO1xuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcih0aW1lUGFzc2VkIC8gKDYwICogNjAwMDApKTtcbiAgICByZXR1cm4gaG91cnM7XG4gIH1cblxuICBjcmVhdGVFbGVtZW50KHRhZykge1xuICAgIHRoaXMuRE9NRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICB0aGlzLnVwZGF0ZUVsZW1lbnQoKTtcbiAgICByZXR1cm4gdGhpcy5ET01FbGVtZW50O1xuICB9XG5cbiAgdXBkYXRlRWxlbWVudCgpIHtcbiAgICBpZiAodGhpcy5ET01FbGVtZW50KSB7XG4gICAgICB0aGlzLkRPTUVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLmdldFRpbWUoKTtcbiAgICB9XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IF9fd2VicGFja19wdWJsaWNfcGF0aF9fICsgXCJhc3NldHMvYXVkaW8vdGlsZS1tb3ZlLm1wM1wiOyIsImltcG9ydCAnLi9zdHlsZS5jc3MnO1xuaW1wb3J0IEdlbVB1enpsZSBmcm9tICcuL2dlbS1wdXp6bGUvZ2VtLXB1enpsZSc7XG5cbmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwYWdlJyk7XG5kb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3BhZ2VfX2lubmVyJyk7XG5cbmNvbnN0IGdlbVB1enpsZSA9IG5ldyBHZW1QdXp6bGUoKTtcbmNvbnN0IGdlbVB1enpsZUVsZW1lbnQgPSBnZW1QdXp6bGUuaW5pdCgpO1xuZG9jdW1lbnQuYm9keS5hcHBlbmQoZ2VtUHV6emxlRWxlbWVudCk7XG4iLCJpbXBvcnQgJy4vc3R5bGUuY3NzJztcbmltcG9ydCBUaW1lciBmcm9tICcuL1RpbWVyJztcbmltcG9ydCB0aWxlTW92ZVNvdW5kIGZyb20gJy4vYXNzZXRzL2F1ZGlvL3RpbGUtbW92ZS5tcDMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHZW1QdXp6bGUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnRpbWVyID0gbmV3IFRpbWVyKCk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHNpemU6IDQsXG4gICAgICB0aWxlczogW10sXG4gICAgICBtb3ZlczogMCxcbiAgICAgIGlzU29sdmVkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgdGhpcy5zdGF0ZVByb3h5ID0gbmV3IFByb3h5KHRoaXMuc3RhdGUsIHtcbiAgICAgIHNldDogKHRhcmdldCwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKSA9PiB7XG4gICAgICAgIGlmIChwcm9wID09PSAnbW92ZXMnKSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50cy5tb3ZlQ291bnRlci50ZXh0Q29udGVudCA9IGBNb3ZlczogJHt2YWx1ZX1gO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHByb3AgPT09ICdzaXplJykge1xuICAgICAgICAgIFJlZmxlY3Quc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKTtcbiAgICAgICAgICB0aGlzLnN0YXJ0TmV3R2FtZSgpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFJlZmxlY3Quc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0ge1xuICAgICAgdGlsZU9uQ2xpY2s6IChldmVudCkgPT4ge1xuICAgICAgICBjb25zdCB7IHRpbGVzLCBzaXplIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBpbmRleCA9IHRpbGVzLm1hcCgodGlsZSkgPT4gdGlsZS5lbGVtZW50KS5pbmRleE9mKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGNvbnN0IHRpbGUgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGdhcFNpemUgPSAyO1xuXG4gICAgICAgIGlmICh0aGlzLmlzVHJhbnNpdGlvbmluZ1xuICAgICAgICAgIHx8IHRoaXMuc3RhdGUuaXNTb2x2ZWRcbiAgICAgICAgICB8fCB0aWxlc1tpbmRleF0/LmlkID09PSAtMVxuICAgICAgICAgIHx8IGluZGV4ID09PSAtMSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy50aW1lci5hY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLnRpbWVyLnN0YXJ0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBnZXRFbXB0eVRpbGVEaXJlY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICBjYXNlIHRpbGVzW2luZGV4IC0gMV0/LmlkID09PSAtMSAmJiBpbmRleCAlIHNpemUgIT09IDA6XG4gICAgICAgICAgICAgIHJldHVybiAnbGVmdCc7XG4gICAgICAgICAgICBjYXNlIHRpbGVzW2luZGV4ICsgMV0/LmlkID09PSAtMSAmJiBpbmRleCAlIHNpemUgIT09IHNpemUgLSAxOlxuICAgICAgICAgICAgICByZXR1cm4gJ3JpZ2h0JztcbiAgICAgICAgICAgIGNhc2UgdGlsZXNbaW5kZXggLSBzaXplXT8uaWQgPT09IC0xOlxuICAgICAgICAgICAgICByZXR1cm4gJ3RvcCc7XG4gICAgICAgICAgICBjYXNlIHRpbGVzW2luZGV4ICsgc2l6ZV0/LmlkID09PSAtMTpcbiAgICAgICAgICAgICAgcmV0dXJuICdib3R0b20nO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBtb3ZlVGlsZSA9IChkaXJlY3Rpb24pID0+IHtcbiAgICAgICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgY2FzZSBmYWxzZTpcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgW3RpbGVzW2luZGV4XSwgdGlsZXNbaW5kZXggLSAxXV0gPSBbdGlsZXNbaW5kZXggLSAxXSwgdGlsZXNbaW5kZXhdXTtcbiAgICAgICAgICAgICAgdGlsZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgtMTAwJSkgdHJhbnNsYXRlWCgtJHtnYXBTaXplfXB4KWA7XG4gICAgICAgICAgICAgIHRoaXMuc3RhdGVQcm94eS5tb3ZlcyArPSAxO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgW3RpbGVzW2luZGV4XSwgdGlsZXNbaW5kZXggKyAxXV0gPSBbdGlsZXNbaW5kZXggKyAxXSwgdGlsZXNbaW5kZXhdXTtcbiAgICAgICAgICAgICAgdGlsZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgxMDAlKSB0cmFuc2xhdGVYKCR7Z2FwU2l6ZX1weClgO1xuICAgICAgICAgICAgICB0aGlzLnN0YXRlUHJveHkubW92ZXMgKz0gMTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgICAgICBbdGlsZXNbaW5kZXhdLCB0aWxlc1tpbmRleCAtIHNpemVdXSA9IFt0aWxlc1tpbmRleCAtIHNpemVdLCB0aWxlc1tpbmRleF1dO1xuICAgICAgICAgICAgICB0aWxlLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKC0xMDAlKSB0cmFuc2xhdGVZKC0ke2dhcFNpemV9cHgpYDtcbiAgICAgICAgICAgICAgdGhpcy5zdGF0ZVByb3h5Lm1vdmVzICs9IDE7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgW3RpbGVzW2luZGV4XSwgdGlsZXNbaW5kZXggKyBzaXplXV0gPSBbdGlsZXNbaW5kZXggKyBzaXplXSwgdGlsZXNbaW5kZXhdXTtcbiAgICAgICAgICAgICAgdGlsZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWSgxMDAlKSB0cmFuc2xhdGVZKCR7Z2FwU2l6ZX1weClgO1xuICAgICAgICAgICAgICB0aGlzLnN0YXRlUHJveHkubW92ZXMgKz0gMTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgYXJndW1lbnQgJyR7ZGlyZWN0aW9ufSdgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgbW92ZVRpbGUoZ2V0RW1wdHlUaWxlRGlyZWN0aW9uKCkpO1xuICAgICAgfSxcblxuICAgICAgdGlsZU9uVHJhbnNpdGlvblN0YXJ0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LnByb3BlcnR5TmFtZSA9PT0gJ3RyYW5zZm9ybScpIHtcbiAgICAgICAgICB0aGlzLmlzVHJhbnNpdGlvbmluZyA9IHRydWU7XG4gICAgICAgICAgbmV3IEF1ZGlvKHRpbGVNb3ZlU291bmQpLnBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgdGlsZU9uVHJhbnNpdGlvbkVuZDogKGV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldmVudC5wcm9wZXJ0eU5hbWUgPT09ICd0cmFuc2Zvcm0nKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJUaWxlcygpO1xuICAgICAgICAgIHRoaXMuY2hlY2tTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgfTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5jcmVhdGVFbGVtZW50cygpO1xuICAgIHRoaXMuZ2VuZXJhdGVUaWxlcygpO1xuICAgIHRoaXMuc3RhcnROZXdHYW1lKCk7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudHMuY29udGFpbmVyO1xuICB9XG5cbiAgc3RhcnROZXdHYW1lKCkge1xuICAgIHRoaXMuc3RhdGUuaXNTb2x2ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXRlUHJveHkubW92ZXMgPSAwO1xuICAgIHRoaXMudGltZXIucmVzZXQoKTtcbiAgICB0aGlzLnNodWZmbGVUaWxlcygpO1xuICAgIHRoaXMucmVuZGVyVGlsZXMoKTtcbiAgICB0aGlzLmVsZW1lbnRzLmJvYXJkLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSBgcmVwZWF0KCR7dGhpcy5zdGF0ZS5zaXplfSwgMWZyKWA7XG4gIH1cblxuICBnZW5lcmF0ZVRpbGVzKCkge1xuICAgIGNvbnN0IHRpbGVBbW91bnQgPSB0aGlzLnN0YXRlLnNpemUgKiogMjtcbiAgICBjb25zdCB0aWxlcyA9IFtdO1xuICAgIGNvbnN0IGVtcHR5VGlsZSA9IHtcbiAgICAgIGlkOiAtMSxcbiAgICAgIGVsZW1lbnQ6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgIH07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRpbGVBbW91bnQgLSAxOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IHRpbGUgPSB7IH07XG4gICAgICB0aWxlLmlkID0gaSArIDE7XG4gICAgICB0aWxlLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRpbGUuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdnZW0tcHV6emxlX190aWxlJyk7XG4gICAgICB0aWxlLmVsZW1lbnQudGV4dENvbnRlbnQgPSB0aWxlLmlkO1xuICAgICAgdGlsZXMucHVzaCh0aWxlKTtcbiAgICB9XG5cbiAgICB0aWxlcy5wdXNoKGVtcHR5VGlsZSk7XG4gICAgdGhpcy5zdGF0ZS50aWxlcyA9IHRpbGVzO1xuICB9XG5cbiAgcmVuZGVyVGlsZXMoKSB7XG4gICAgY29uc3QgeyB0aWxlcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXG4gICAgdGlsZXMuZm9yRWFjaCgodGlsZSkgPT4ge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgICB0aWxlLmVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gJyc7XG4gICAgICB0aWxlQ29udGFpbmVyLmFwcGVuZCh0aWxlLmVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5lbGVtZW50cy5ib2FyZC5hcHBlbmQodGlsZUNvbnRhaW5lcik7XG4gICAgdGhpcy5pc1RyYW5zaXRpb25pbmcgPSBmYWxzZTtcbiAgfVxuXG4gIGNoZWNrU3RhdGUoKSB7XG4gICAgY29uc3QgdGlsZUlkcyA9IHRoaXMuc3RhdGUudGlsZXMubWFwKCh0aWxlKSA9PiB0aWxlLmlkKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpICsgMiA8IHRpbGVJZHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmICh0aWxlSWRzW2kgKyAxXSAhPT0gdGlsZUlkc1tpXSArIDEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMudGltZXIucGF1c2UoKTtcbiAgICB0aGlzLnN0YXRlLmlzU29sdmVkID0gdHJ1ZTtcblxuICAgIC8vIHNldFRpbWVvdXQgdG8gZmlyZSBhbGVydCBvbmNlIHRoZSBldmVudCBsb29wIGlzIGVtcHR5XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBhbGVydChgWW91IHNvbHZlZCB0aGUgcHV6emxlIGluICR7dGhpcy50aW1lci5nZXRUaW1lKCl9IGFuZCBtYWRlICR7dGhpcy5zdGF0ZS5tb3Zlc30gbW92ZXMuYCk7XG4gICAgfSwgMCk7XG4gIH1cblxuICBzaHVmZmxlVGlsZXMoKSB7XG4gICAgY29uc3QgdGlsZUFtb3VudCA9IHRoaXMuc3RhdGUuc2l6ZSAqKiAyO1xuICAgIGNvbnN0IHsgdGlsZXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRpbGVBbW91bnQ7IGkgKz0gMSkge1xuICAgICAgY29uc3QgcmFuZG9tVGlsZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRpbGVBbW91bnQpO1xuICAgICAgW3RpbGVzW2ldLCB0aWxlc1tyYW5kb21UaWxlXV0gPSBbdGlsZXNbcmFuZG9tVGlsZV0sIHRpbGVzW2ldXTtcbiAgICB9XG5cbiAgICAvLyBTaHVmZmxlIHVudGlsIHNvbHZhYmxlIGNvbWJpbmF0aW9uIGlzIGZvdW5kXG4gICAgaWYgKCF0aGlzLmlzU29sdmFibGUoKSkgdGhpcy5zaHVmZmxlVGlsZXMoKTtcbiAgfVxuXG4gIGlzU29sdmFibGUoKSB7XG4gICAgY29uc3QgeyB0aWxlcywgc2l6ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB0aWxlSWRzID0gdGlsZXMubWFwKCh0aWxlKSA9PiB0aWxlLmlkKTtcbiAgICBjb25zdCBlbXB0eVRpbGVJbmRleCA9IHRpbGVJZHMuaW5kZXhPZigtMSk7XG4gICAgY29uc3QgZW1wdHlUaWxlUm93ID0gTWF0aC5jZWlsKChlbXB0eVRpbGVJbmRleCArIDEpIC8gc2l6ZSk7XG4gICAgbGV0IGludmVyc2lvbnMgPSAwO1xuXG4gICAgLy8gQ291bnQgaW52ZXJzaW9uc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGlsZUlkcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKHRpbGVJZHNbaV0gIT09IC0xKSB7XG4gICAgICAgIGZvciAobGV0IGogPSBpOyBqIDwgdGlsZUlkcy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgIGlmICh0aWxlSWRzW2ldID4gdGlsZUlkc1tqXSAmJiB0aWxlSWRzW2pdICE9PSAtMSkge1xuICAgICAgICAgICAgaW52ZXJzaW9ucyArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIE4gaXMgb2RkLCB0aGVuIHB1enpsZSBpbnN0YW5jZSBpcyBzb2x2YWJsZSBpZiBudW1iZXIgb2YgaW52ZXJzaW9ucyBpcyBldmVuLlxuICAgIGlmIChzaXplICUgMiA9PT0gMSAmJiBpbnZlcnNpb25zICUgMiA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHNpemUgJSAyID09PSAwKSB7XG4gICAgICBpZiAoZW1wdHlUaWxlUm93ICUgMiA9PT0gMSAmJiBpbnZlcnNpb25zICUgMiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChlbXB0eVRpbGVSb3cgJSAyID09PSAwICYmIGludmVyc2lvbnMgJSAyID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNyZWF0ZUVsZW1lbnRzKCkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IHN0YXR1c0JhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29uc3QgdGltZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgY29uc3QgbW92ZUNvdW50ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgY29uc3QgbmV3R2FtZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXG4gICAgLy8gTWFpbiBlbGVtZW50cyBzZXR1cFxuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdnZW0tcHV6emxlJyk7XG4gICAgc3RhdHVzQmFyLmNsYXNzTGlzdC5hZGQoJ2dlbS1wdXp6bGVfX3N0YXR1cy1iYXInKTtcbiAgICBib2FyZC5jbGFzc0xpc3QuYWRkKCdnZW0tcHV6emxlX19ib2FyZCcpO1xuICAgIGJvYXJkLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSBgcmVwZWF0KCR7dGhpcy5zdGF0ZS5zaXplfSwgMWZyKWA7XG4gICAgYm9hcmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmV2ZW50TGlzdGVuZXJzLnRpbGVPbkNsaWNrKTtcbiAgICBib2FyZC5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uc3RhcnQnLCB0aGlzLmV2ZW50TGlzdGVuZXJzLnRpbGVPblRyYW5zaXRpb25TdGFydCk7XG4gICAgYm9hcmQuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIHRoaXMuZXZlbnRMaXN0ZW5lcnMudGlsZU9uVHJhbnNpdGlvbkVuZCk7XG5cbiAgICAvLyBUaW1lciBzZXR1cFxuICAgIHRpbWVyLnRleHRDb250ZW50ID0gJ1RpbWVyOiAnO1xuICAgIHRpbWVyLmFwcGVuZCh0aGlzLnRpbWVyLmNyZWF0ZUVsZW1lbnQoJ3RpbWUnKSk7XG5cbiAgICAvLyBNb3ZlIGNvdW50ZXIgc2V0dXBcbiAgICBtb3ZlQ291bnRlci50ZXh0Q29udGVudCA9ICdNb3ZlczogMCc7XG5cbiAgICAvLyBOZXcgZ2FtZSBidXR0b24gc2V0dXBcbiAgICBuZXdHYW1lQnRuLnR5cGUgPSAnYnV0dG9uJztcbiAgICBuZXdHYW1lQnRuLmNsYXNzTGlzdC5hZGQoJ2dlbS1wdXp6bGVfX2J1dHRvbicpO1xuICAgIG5ld0dhbWVCdG4udGV4dENvbnRlbnQgPSAnTmV3IGdhbWUnO1xuICAgIG5ld0dhbWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLnN0YXJ0TmV3R2FtZSgpO1xuICAgIH0pO1xuXG4gICAgc3RhdHVzQmFyLmFwcGVuZCh0aW1lciwgbmV3R2FtZUJ0biwgbW92ZUNvdW50ZXIpO1xuICAgIGNvbnRhaW5lci5hcHBlbmQoc3RhdHVzQmFyLCBib2FyZCk7XG5cbiAgICB0aGlzLmVsZW1lbnRzID0ge1xuICAgICAgY29udGFpbmVyLFxuICAgICAgc3RhdHVzQmFyLFxuICAgICAgYm9hcmQsXG4gICAgICB0aW1lcixcbiAgICAgIG1vdmVDb3VudGVyLFxuICAgIH07XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=